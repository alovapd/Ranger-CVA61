<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naval Navigation Deck Log System - USS Ranger CVA-61</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#1f2937">
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
    <link rel="apple-touch-icon" href="./apple-touch-icon.png">
    
    <!-- Meta Tags for SEO and Social -->
    <meta name="description" content="Professional maritime navigation logging system for USS Ranger CVA-61, featuring interactive mapping, coordinate tracking, and historical data visualization.">
    <meta name="keywords" content="naval navigation, maritime, USS Ranger, navigation log, coordinates, mapping">
    <meta name="author" content="Naval Navigation System">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Naval Navigation Deck Log System">
    <meta property="og:description" content="Professional maritime navigation logging system for USS Ranger CVA-61">
    <meta property="og:image" content="./assets/og-image.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Naval Navigation Deck Log System">
    <meta property="twitter:description" content="Professional maritime navigation logging system for USS Ranger CVA-61">
    
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="./css/styles.css">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>‚öì Naval Navigation System</h2>
            <p>USS Ranger CVA-61 ‚Ä¢ Initializing Navigation Systems...</p>
            <div class="loading-progress">
                <div class="loading-bar"></div>
            </div>
        </div>
    </div>

    <!-- Error Display -->
    <div id="error-display" class="error-display" style="display: none;">
        <div class="error-content">
            <h2>üö® System Error</h2>
            <p id="error-message">Navigation system failed to initialize. Please check console for details.</p>
            <button onclick="location.reload()" class="btn btn-primary">Reload System</button>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="app-title">
                        <span class="ship-icon">‚öì</span>
                        Naval Navigation Deck Log
                        <span class="ship-designation">USS Ranger CVA-61</span>
                    </h1>
                </div>
                <div class="header-right">
                    <div class="status-indicator" id="system-status">
                        <span class="status-dot online"></span>
                        <span class="status-text">System Online</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Alert Container -->
        <div id="alert-container" class="alert-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Navigation Panel -->
            <section class="panel navigation-panel">
                <div class="panel-header">
                    <h3>üß≠ Navigation Plot</h3>
                </div>
                <div class="panel-content">
                    <!-- Map Container -->
                    <div id="map" class="map-container"></div>
                    
                    <!-- Plot Controls -->
                    <div class="plot-controls">
                        <div class="date-range-container">
                            <h4>üìÖ Plot Date Range</h4>
                            <div class="date-inputs">
                                <div class="input-group">
                                    <label for="plot-start-date">From:</label>
                                    <input type="date" id="plot-start-date" class="form-control date-input">
                                </div>
                                <div class="input-group">
                                    <label for="plot-end-date">To:</label>
                                    <input type="date" id="plot-end-date" class="form-control date-input">
                                </div>
                            </div>
                            <div class="plot-buttons">
                                <button id="plot-track-btn" class="btn btn-primary">üó∫Ô∏è Plot Track</button>
                                <button id="plot-all-btn" class="btn btn-secondary">üìç Plot All Data</button>
                                <button id="clear-track-btn" class="btn btn-outline">üßπ Clear Track</button>
                            </div>
                        </div>
                        
                        <!-- System Controls -->
                        <div class="system-controls">
                            <h4>‚öôÔ∏è System Controls</h4>
                            <div class="control-buttons">
                                <button id="theme-btn" class="btn btn-outline">üé® Theme</button>
                                <button id="settings-btn" class="btn btn-outline">‚öôÔ∏è Settings</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Data Management Panel -->
            <section class="panel data-panel">
                <div class="panel-header">
                    <h3>üìä Navigation Data</h3>
                    <div class="panel-stats">
                        <span id="data-count" data-stat="totalEntries">0 entries</span>
                    </div>
                </div>
                
                <!-- Data Controls -->
                <div class="data-controls">
                    <div class="control-group">
                        <button id="add-entry-btn" class="btn btn-primary">‚ûï Add Entry</button>
                        <button id="import-data-btn" class="btn btn-secondary">üì• Import Data</button>
                        <button id="export-data-btn" class="btn btn-outline">üì§ Export Data</button>
                    </div>
                    
                    <!-- Search and Filter -->
                    <div class="search-controls">
                        <input type="text" id="search-input" class="form-control" placeholder="üîç Search navigation entries...">
                        <select id="filter-importance" class="form-control">
                            <option value="all">All Entries</option>
                            <option value="important">‚≠ê Important Only</option>
                            <option value="normal">Standard Entries</option>
                        </select>
                    </div>
                </div>

                <!-- Data Table Container -->
                <div class="table-container">
                    <div id="navigation-table" class="navigation-table">
                        <!-- Table will be populated by JavaScript -->
                    </div>
                </div>
            </section>
        </main>

        <!-- Entry Form Modal -->
        <div id="entry-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-title">Add Navigation Entry</h3>
                    <button class="modal-close" id="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="navigation-form" class="navigation-form">
                        <!-- Form fields will be populated by JavaScript -->
                    </form>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‚öôÔ∏è System Settings</h3>
                    <button class="modal-close" id="settings-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="settings-content">
                        <!-- Settings will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- File Input (Hidden) -->
        <input type="file" id="file-input" accept=".json,.csv" style="display: none;">
    </div>

    <!-- JavaScript Libraries -->
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>

    <!-- Application JavaScript - NO MODULES, TRADITIONAL LOADING -->
    <script>
        // Global error handler
        window.addEventListener('error', function(e) {
            console.error('Global error:', e);
            showInitializationError('JavaScript error: ' + e.message);
        });

        // Show initialization error
        function showInitializationError(message) {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('app').style.display = 'none';
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-display').style.display = 'flex';
        }

        // Hide loading screen and show app
        function showApplication() {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('error-display').style.display = 'none';
            document.getElementById('app').style.display = 'block';
        }

        // Initialize loading progress
        let loadingProgress = 0;
        const progressBar = document.querySelector('.loading-bar');
        
        function updateProgress(percent, message) {
            loadingProgress = Math.min(percent, 100);
            if (progressBar) {
                progressBar.style.width = loadingProgress + '%';
            }
            if (message) {
                const loadingText = document.querySelector('.loading-content p');
                if (loadingText) {
                    loadingText.textContent = message;
                }
            }
        }

        // Start loading
        updateProgress(10, 'Loading configuration...');
    </script>

    <!-- Load Configuration First -->
    <script src="./js/config.js"></script>
    <script>updateProgress(20, 'Loading core modules...');</script>

    <!-- Core Modules -->
    <script src="./js/core/data-manager.js"></script>
    <script src="./js/core/storage.js"></script>
    <script src="./js/core/settings.js"></script>
    <script>updateProgress(40, 'Loading UI components...');</script>

    <!-- UI Modules -->
    <script src="./js/ui/alerts.js"></script>
    <script src="./js/ui/forms.js"></script>
    <script src="./js/ui/tables.js"></script>
    <script src="./js/ui/themes.js"></script>
    <script src="./js/ui/shortcuts.js"></script>
    <script>updateProgress(60, 'Loading navigation systems...');</script>

    <!-- Navigation Modules -->
    <script src="./js/navigation/coordinates.js"></script>
    <script src="./js/navigation/distance.js"></script>
    <script src="./js/navigation/mapping.js"></script>
    <script>updateProgress(80, 'Loading application data...');</script>

    <!-- Data -->
    <script src="./data/landmass.js"></script>
    <script>updateProgress(90, 'Initializing application...');</script>

    <!-- Main Application (Load Last) -->
    <script src="./js/core/app.js"></script>

    <!-- Application Initialization -->
    <script>
        // Wait for DOM and all scripts to load
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress(95, 'Starting navigation system...');
            
            // Small delay to ensure everything is loaded
            setTimeout(async function() {
                try {
                    // Initialize the application
                    if (typeof NavalNavigationApp === 'undefined') {
                        throw new Error('NavalNavigationApp class not found');
                    }
                    
                    updateProgress(100, 'System ready!');
                    
                    // Show application
                    setTimeout(showApplication, 500);
                    
                } catch (error) {
                    console.error('Application initialization failed:', error);
                    showInitializationError('Failed to initialize: ' + error.message);
                }
            }, 100);
        });

        // Service Worker Registration (PWA)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                const swPath = window.location.pathname.endsWith('/') 
                    ? window.location.pathname + 'service-worker.js'
                    : window.location.pathname + '/service-worker.js';
                    
                navigator.serviceWorker.register(swPath)
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>

    <!-- Add Clear Track Button Functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const clearTrackBtn = document.getElementById('clear-track-btn');
            if (clearTrackBtn) {
                clearTrackBtn.addEventListener('click', function() {
                    if (window.navalApp && window.navalApp.mapping) {
                        window.navalApp.mapping.clearTrack();
                    }
                });
            }
        });
    </script>
</body>
</html>